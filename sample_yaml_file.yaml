version: "0.1"

# --- Base Image ---
image: playwrightjs           # HyperExecute image with Playwright pre-installed

# --- Timeouts (in minutes) ---
globalTimeout: 150            # Total job timeout
testSuiteTimeout: 150         # Timeout for the individual pods in a job
testSuiteStep: 150            # Timeout per test stage

# --- Execution Environment ---
runson: linux                 # Target OS
concurrency: 1                # Number of parallel runners
autosplit: true               # Enable test autosplitting across runners
alwaysRunPostSteps: true      # Ensure post steps always run, even if job fails

# --- Caching ---
cacheKey: '{{ checksum "package.json" }}'  # Change detection based on package.json
cacheDirectories:
  - node_modules                          # Cache node_modules to speed up installs

# --- Project Metadata ---
project:
  name: "demo-project"                    # Replace with your project name
  id: "01K0NY4VAGNN1CE3T72XCNM1C7"                 # Replace with your actual project ID

# --- Environment Variables ---
env:
  PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD: 1    # Avoid downloading browser binaries

# --- Pre-Execution Commands ---
pre:
  - echo "Starting npm install..."
  - npm install                          # Install dependencies
  - npm install playwright@1.42.0        # Match the version in the package.json

# --- Test Discovery ---
testDiscovery:
  mode: remote                           # Required for autosplit
  command: echo test                     # Placeholder command

# --- Test Runner Command ---
testRunnerCommand: npx playwright test   # Replace with your custom Playwright run command if needed

# --- Artefact Upload Configuration ---
uploadArtefacts:
  - name: PW Reports
    path:
      - playwright-report/**             # Default report output from Playwright
    # Optional: Send artefacts via email
    # NOTE: Must be properly indented
    # email:
    #   to:
    #     - abc@example.com

 
# --- Post Execution Steps ---
post:
  - ls -la                               # View generated files (can be customized)

# --- Job Label for Filtering in Dashboard ---
jobLabel: [playwright, js, autosplit]
